<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+Mono+TC&display=swap" rel="stylesheet">

  <meta charset="utf-8">
  <title>{{title}}</title>
  <style>
      body {
            font-family: 'LXGW WenKai Mono TC','Microsoft JhengHei','jf-openhuninn', 'Gen Jyuu Gothic', 'Noto Sans TC', sans-serif;
            background-color: #f8f9fa;
            color: rgba(15, 34, 34, 0.68);
            margin: 0;
            padding: 0;
        }
        :lang(en),
        .en-font,
        input,
        button,
        code,
        kbd {
            font-family: 'LXGW WenKai Mono TC','Roboto', sans-serif;
        }
    .panel {
      text-align: center;
    }
  .track-icon-vocals {
      width: 64px;
      height: 64px;
      margin: 10px;
      position: fixed;
      top: 50%;
      left: 22%;
      rotate: -20deg;
      cursor: pointer;
      transition: transform 0.2s ease, opacity 0.2s;
    }
    .track-icon-vocals.muted {
      opacity: 0.3;
    }
    .track-icon-vocals:hover {
      opacity: 0.9;
      transform: scale(1.1);
    }

  .track-icon-drums {
      width: 64px;
      height: 64px;
      margin: 10px;
      position: fixed;
      top: 43%;
      left: 34%;
      rotate: 0deg;
      cursor: pointer;
      transition: transform 0.2s ease, opacity 0.2s;
    }
      .track-icon-drums.muted {
      opacity: 0.3;
    }
      .track-icon-drums:hover {
      opacity: 0.9;
      transform: scale(1.1);
    }
.track-icon-other {
      width: 60px;
      height: 60px;
      margin: 10px;
      position: fixed;
      top: 43%;
      right: 36%;
      rotate: 0deg;
      cursor: pointer;
      transition: transform 0.2s ease, opacity 0.2s;
    }
    .track-icon-other.muted {
      opacity: 0.3;
    }
    .track-icon-other:hover {
      opacity: 0.9;
      transform: scale(1.1);
    }

  .track-icon-bass {
      width: 64px;
      height: 64px;
      margin: 10px;
      position: fixed;
      top: 50%;
      right: 24%;
      rotate: 0deg;
      cursor: pointer;
      transition: transform 0.2s ease, opacity 0.2s;
    }
    .track-icon-bass.muted {
      opacity: 0.3;
    }
    .track-icon-bass:hover {
      opacity: 0.9;
      transform: scale(1.1);
    }

  .history-toggle-icon {
    position: fixed;
    top: 10px;
    right: 10px;
    width: 38px;
    height: 38px;
    font-size: 30px;
    cursor: pointer;
    z-index: 1000;
  }

  .drawer {
    position: fixed;
    top: 0;
    right: -300px;
    width: 300px;
    height: 100%;
    background-color: #fefefe;
    border-left: 1px solid #ccc;
    box-shadow: -2px 0 5px rgba(0,0,0,0.2);
    transition: right 0.3s ease;
    z-index: 1100;
    padding: 1px;
    backdrop-filter: blur(6px);
    background-color: rgba(255, 255, 255, 0.85);
  }


    .drawer.open {
    right: 0;
    top: 0;

  }

  .drawer-header {
    font-weight: bold;
    padding: 10px;
    background-color: #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
    }

  .close-arrow {
    cursor: pointer;
    font-size: 20px;
  }

  .drawer-body {
    padding: 10px;
    max-height: 200px;
    overflow-y: auto;
  }

  .history-entry {
    margin-bottom: 10px;
    border-bottom: 1px solid #ddd;
    padding-bottom: 5px;
  }
.reset-button {
  position: fixed;
  left: 10px;
  top: 10px;
  padding: 8px 16px;
  font-size: 16px;
  background-color: #ffdddd;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.2s;
}
.reset-button:hover {
  background-color: #c7abab;
}

.now-playing {
  position: fixed;
  top: 20%;
  left: 50%;
  transform: translateX(-50%);
  font-size: 16px;
  color: #333;
  background-color: rgba(255, 255, 255, 0.8);
  padding: 8px 28px;
  border-radius: 10px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.15);
  z-index: 999;
  white-space: nowrap;
  max-width: 90vw;
  overflow: hidden;
  text-overflow: ellipsis;
  text-align: center;


}

.player-container {
  position: fixed;
  left: 50%;
  bottom: 15%;
  transform: translateX(-50%);
  width: 60%;
  display: flex;
  flex-direction: column;
  align-items: center;
  z-index: 998;
  gap: 10px;
}

#play-button {
    width: 64px;
    height: 64px;
    cursor: pointer;
    position: fixed;
    bottom: 28%;
    left: 45%;
}
.progress-area {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  max-width: 480px;
}
#progress-bar {
  flex-grow: 1;
  height: 6px;
  border-radius: 4px;
  border: none;
  background: #ccc;
  appearance: none;
  -webkit-appearance: none;
  outline: none;
}

#progress-bar::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 12px solid #333;
  cursor: pointer;
  margin-top: -6px;
  position: relative;
}
#progress-bar::-webkit-slider-thumb:hover {
  border-top-color: #595237;
}
/* ÁõÆÂâçÊí≠ÊîæÊôÇÈñì */
#current-time {
  font-family: 'Roboto Mono', monospace;
  font-size: 14px;
  color: #444;
  min-width: 48px;
}
/* ÊãñÊõ≥ÈªûÊ®£Âºè */

</style>
</head>
<body>
  <div class="panel">
    <div class="track-grid">
  <img src="/static/icons/vocals.png" class="track-icon-vocals" id="vocals-icon" onclick="toggleMute('vocals')">
  <img src="/static/icons/drums.png" class="track-icon-drums" id="drums-icon" onclick="toggleMute('drums')">
  <img src="/static/icons/bass.png" class="track-icon-bass" id="bass-icon" onclick="toggleMute('bass')">
  <img src="/static/icons/other.png" class="track-icon-other" id="other-icon" onclick="toggleMute('other')">
 </div>

</div>
<div class="now-playing">
  <div class="label">ÁõÆÂâçÊí≠ÊîæÔºö</div>
  <div class="track-title">{{ title }}</div>
</div>

  <button class="reset-button" onclick="location.href='/reset'">ÂàÜÊûêÊñ∞Ê≠åÊõ≤</button>
  <img src="/static/icons/history.png" class="history-toggle-icon" onclick="toggleHistory()" />


<div id="historyDrawer" class="drawer">
  <div class="drawer-header">
    Ê≠∑Âè≤Êõ≤ÁõÆ
    <span class="close-arrow" onclick="toggleHistory()">‚úñ</span>
  </div>
  <div id="historyContent">
    {% if history %}
      {% for item in history %}
        <div class="history-entry">
          <strong>{{ item.title }}</strong><br>
          <a href="/static/{{ item.folder }}/vocals.mp3" target="_blank">üé§</a>
          <a href="/static/{{ item.folder }}/drums.mp3" target="_blank">ü•Å</a>
          <a href="/static/{{ item.folder }}/bass.mp3" target="_blank">üé∏</a>
          <a href="/static/{{ item.folder }}/other.mp3" target="_blank">üéπ</a>
        </div>
      {% endfor %}
    {% else %}
      <p>Â∞öÁÑ°Ê≠∑Âè≤Á¥ÄÈåÑ</p>
    {% endif %}
  </div>
</div>

<img id="play-button" src="/static/icons/play.png" onclick="togglePlayPause()" />

<div class="player-container">
  <div class="time-display" id="current-time">00:00 / 00:00</div>
  <div class="progress-area">
    <input type="range" id="progress-bar" value="0" step="1" min="0" max="100">
  </div>
</div>


  <!-- Èü≥Ë®äÂÖÉÁ¥† -->
  <audio id="vocals" src="/static/{{folder}}/vocals.mp3" loop></audio>
  <audio id="drums" src="/static/{{folder}}/drums.mp3" loop></audio>
  <audio id="bass" src="/static/{{folder}}/bass.mp3" loop></audio>
  <audio id="other" src="/static/{{folder}}/other.mp3" loop></audio>

<script>
  const tracks = ['vocals', 'drums', 'bass', 'other'];
  let isPlaying = false;
  let progressTimer = null;


  function toggleMute(name) {
    const audio = document.getElementById(name);
    const icon = document.getElementById(name + "-icon");
    audio.muted = !audio.muted;
    icon.classList.toggle("muted", audio.muted);
  }

  function togglePlayPause() {
    isPlaying = !isPlaying;
    const playBtn = document.getElementById("play-button");
    playBtn.src = isPlaying ? "/static/icons/pause.png" : "/static/icons/play.png";

    tracks.forEach(name => {
      const audio = document.getElementById(name);
      if (isPlaying) {
        audio.play().catch(err => {
         console.error(`Êí≠Êîæ ${name} ÊôÇÂá∫ÈåØÔºö`, err);
       });
      } else {
        audio.pause();
      }
  });
  if (isPlaying) {
  startProgressUpdater();
  } else {
  clearInterval(progressTimer);
}

 }
function startProgressUpdater() {
  const progressBar = document.getElementById("progress-bar");
  const mainAudio = document.getElementById("vocals");
  const timeDisplay = document.getElementById("current-time");

  progressTimer = setInterval(() => {
    if (mainAudio.duration) {
        const currentTime = mainAudio.currentTime;
        const duration = mainAudio.duration;

      progressBar.value = (mainAudio.currentTime / mainAudio.duration) * 100;

      const currentMin = Math.floor(currentTime / 60);
      const currentSec = Math.floor(currentTime % 60).toString().padStart(2, '0');
      const durationMin = Math.floor(duration / 60);
      const durationSec = Math.floor(duration % 60).toString().padStart(2, '0');

      timeDisplay.textContent = `${currentMin}:${currentSec} / ${durationMin}:${durationSec}`;
    }
  }, 500);
}

document.getElementById("progress-bar").addEventListener("input", function () {
  const mainAudio = document.getElementById("vocals");
  if (mainAudio.duration) {
    const percent = this.value / 100;
    mainAudio.currentTime = percent * mainAudio.duration;

    const current = mainAudio.currentTime;
    const duration = mainAudio.duration;

    const currentMin = Math.floor(current / 60);
    const currentSec = Math.floor(current % 60).toString().padStart(2, '0');
    const durationMin = Math.floor(duration / 60);
    const durationSec = Math.floor(duration % 60).toString().padStart(2, '0');

    document.getElementById("current-time").textContent = `${currentMin}:${currentSec} / ${durationMin}:${durationSec}`;

    tracks.forEach(name => {
      document.getElementById(name).currentTime = current;
    });
  }
});
  function toggleHistory() {
    const drawer = document.getElementById("historyDrawer");
    drawer.classList.toggle("open");
    }
</script>
</body>
</html>
